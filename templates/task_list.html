{% extends "layout.html" %}
{% block title %}Lista de tareas{% endblock %}

{% block content %}
<section class="toolbar">
    <form method="GET" action="{{ url_for('tasks.index') }}" class="filters">
        <label>Estado:
        <select name="state" onchange="this.form.submit()">
            <option value="all" {% if state == 'all' %}selected{% endif %}>Todas</option>
            <option value="pending" {% if state == 'pending' %}selected{% endif %}>Pendientes</option>
            <option value="completed" {% if state == 'completed' %}selected{% endif %}>Completadas</option>
        </select>
        </label>
        <label>Orden:
        <select name="sort" onchange="this.form.submit()">
            <option value="due_date" {% if sort == 'due_date' %}selected{% endif %}>Fecha Vencimiento</option>
            <option value="title" {% if sort == 'title' %}selected{% endif %}>Título</option>
        </select>
        </label>
        </form>
</section>

{% if tasks|length == 0 %}
    <p class="empty">No hay tareas para mostrar.</p>
    {% else %}
    <ul class="task-list">
        {% for task in tasks %}
        <li class="task {{ 'completed' if task.completed }} {{ 'overdue' if (not task.completed and task.is_overdue) }}">
            <div class="task-main">
            <h3>{{ task.title }}</h3>
            {% if task.description %}
                <p class="desc">{{ task.description }}</p>
            {% endif %}
            {% if task.due_date %}
                <p class="meta">Vence: {{ task.due_date.strftime('%Y-%m-%d') }}</p>
            {% endif %}
            </div>

            <div class="task-actions">
            <form method="POST" action="{{ url_for('tasks.toggle_task', task_id=task.id) }}">
                <button type="submit" class="btn small">
                {% if task.completed %}↩ Marcar Pendiente{% else %}✔ Marcar Completada{% endif %}
                </button>
            </form>

            <a class="btn small" href="{{ url_for('tasks.edit_task', task_id=task.id) }}">✏ Editar</a>

            <form method="POST" action="{{ url_for('tasks.delete_task', task_id=task.id) }}" onsubmit="return confirm('¿Eliminar esta tarea?');">
                <button type="submit" class="btn small danger">🗑 Eliminar</button>
            </form>
            </div>
        </li>
        {% endfor %}
    </ul>
{% endif %}
{% endblock %}

